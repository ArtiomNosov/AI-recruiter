{% extends "view_resume/base.html" %}

{% block title %}{{ resume.user.get_full_name }} - –†–µ–∑—é–º–µ{% endblock %}

{% block content %}


<div class="hero-form">
    <div class="text-content">
        <h1 class="title">{{ resume.user.get_full_name|default:resume.user.username }}</h1>
        <p class="subtitle">{{ resume.vacancy.title }}</p>
    </div>

    <div class="resume-container">
        <div class="resume-card">
            <div class="resume-meta">
                <p><strong>–§–æ—Ä–º–∞—Ç:</strong> {{ resume.get_fmt_display }}</p>
                <p><strong>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</strong> {{ resume.uploaded_at|date:"d.m.Y H:i" }}</p>
                <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> 
                    <span class="rating">{{ resume.likes.count }}</span>
                    <span class="rating-actions">
                        <a href="{% url 'like_resume' resume.id %}?action=like" class="like-btn">üëç</a>
                        <a href="{% url 'like_resume' resume.id %}?action=dislike" class="dislike-btn">üëé</a>
                    </span>
                </p>
            </div>
            
            <div class="resume-preview">
                {% if file_ext == 'pdf' %}
                <!-- PDF Viewer –∏ —Ç–µ–∫—Å—Ç -->
                <div class="preview-options">
                    <button class="view-btn active" data-target="pdf-view">–ü—Ä–æ—Å–º–æ—Ç—Ä PDF</button>
                    <button class="view-btn" data-target="text-view">–¢–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ</button>
                </div>
                
                <div id="pdf-view" class="view-content active">
                    <iframe src="{{ file_url }}#toolbar=0" width="100%" height="600px" style="border: none;"></iframe>
                </div>
                
                <div id="text-view" class="view-content">
                    <div class="text-content">
                        {% if text_content %}
                            <pre>{{ text_content }}</pre>
                        {% else %}
                            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞</p>
                        {% endif %}
                    </div>
                </div>
                
                {% elif file_ext in 'doc docx' and google_docs_url %}
                <!-- DOC/DOCX —á–µ—Ä–µ–∑ Google Docs -->
                <iframe src="{{ google_docs_url }}" width="100%" height="600px" style="border: none;"></iframe>
                <p class="doc-notice">
                    –§–∞–π–ª –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Google Docs Viewer. 
                    <a href="{{ file_url }}" download>–°–∫–∞—á–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª</a>
                </p>
                
                {% else %}
                <!-- –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç -->
                <div class="unsupported-format">
                    <p>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.</p>
                    <a href="{{ file_url }}" download class="download-btn">
                        <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª (.{{ file_ext }})
                    </a>
                </div>
                {% endif %}
            </div>
            
            <div class="resume-actions">
                <a href="{{ resume.file.url }}" class="download-btn" download>
                    –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—é–º–µ
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.resume-container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
}

.resume-card {
    background: #FFFFFF;
    border: 1px solid #D9D9D9;
    border-radius: 8px;
    padding: 32px;
    margin-top: 24px;
}

.resume-meta {
    margin-bottom: 24px;
}

.resume-meta p {
    margin: 8px 0;
}

.resume-preview {
    margin: 20px 0;
    border: 1px solid #eee;
    padding: 10px;
    min-height: 300px;
}

    
.preview-options {
        margin-bottom: 15px;
    }
    

.view-btn {
        padding: 8px 16px;
        margin-right: 8px;
        background: #f0f0f0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .view-btn.active {
        background: #2C2C2C;
        color: white;
    }

.view-content {
    display: none;
}

.view-content.active {
    display: block;
}

.text-content {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        background: #f9f9f9;
        border-radius: 5px;
        padding: 15px;
        margin: 10px 0;
        white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ */
        overflow-wrap: break-word; /* –ü–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–ª–æ–≤ */
        border: 1px solid #e0e0e0;
    }

.rating {
    font-weight: bold;
    margin: 0 5px;
}

.rating-actions a {
    text-decoration: none;
    margin: 0 5px;
    font-size: 18px;
}

.like-btn:hover {
    color: green;
}

.dislike-btn:hover {
    color: red;
}

.download-btn {
    display: inline-block;
    padding: 12px 24px;
    background: #2C2C2C;
    color: #FFFFFF;
    border-radius: 8px;
    text-decoration: none;
    margin-top: 16px;
}

.download-btn:hover {
    background: #1E1E1E;
}
</style>

<script>
document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // –£–¥–∞–ª—è–µ–º active —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        document.querySelectorAll('.view-btn, .view-content').forEach(el => {
            el.classList.remove('active');
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º active –∫ —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É
        this.classList.add('active');
        document.getElementById(this.dataset.target).classList.add('active');
    });
});
</script>
{% endblock %}